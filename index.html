<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8">
    <!--

    @license twgl.js Copyright (c) 2015, Gregg Tavares All Rights Reserved.
    Available via the MIT license.
    see: http://github.com/greggman/twgl.js for details

    -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta property="og:title" content="X-TRA GEAR" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="http://twgljs.org/examples/screenshots/tiny.png" />
    <meta property="og:description" content="X-TRA GEAT" />
    <meta property="og:url" content="http://xtragear.services" />

    <link rel="stylesheet" type="text/css" href="static/css/styles.css"> 

    <title>X-TRA</title>
  
  </head>


  <body>
  	<div class="center">
    	<canvas id="c"></canvas>
	</div>
  </body>

<!-- VERTEX SHADER -->
 <script id="vs" type="notjs">
attribute vec4 position;

void main() {
  gl_Position = position;
}
  </script>

<!-- FRAGMENT SHADER -->
  <script id="fs" type="notjs">
precision mediump float;

  precision mediump float;
precision mediump int;

uniform sampler2D tex;
uniform sampler2D phase_tex_r;
uniform sampler2D phase_tex_g;
uniform sampler2D phase_tex_b;
uniform vec2 resolution;

uniform float time  ;  

#define SUM_RGB(v) ((v).r + (v).g + (v).b)

#define MODULUS(a, b) (a - (b * floor(a/b)) )

#define SCALED_TEX_COORD(xy, resolution) (abs(vec2(0.0, 1.0) - xy / resolution))

void main(){

float scale = 0.08;
float pixels = 3.0;
vec2 distance = vec2(pixels, pixels) / resolution;
  
  vec2 posn = SCALED_TEX_COORD(gl_FragCoord.xy, resolution);

  vec2 pos_r = MODULUS(posn + vec2(distance.x, 0.0), 1.0);
  vec2 pos_l = MODULUS(posn + vec2(-distance.x, 0.0), 1.0);
  vec2 pos_u = MODULUS(posn + vec2(0.0, -distance.y), 1.0);
  vec2 pos_d = MODULUS(posn + vec2(0.0, distance.y), 1.0);
 
  vec3 dx_ = texture2D(tex, pos_l).rgb - texture2D(tex, pos_r).rgb;
  vec3 dy_ = texture2D(tex, pos_u).rgb - texture2D(tex, pos_d).rgb;
  
  // sum rgb-channels
  float dt = SUM_RGB( texture2D( phase_tex_r, posn ) );

  float dt_g = SUM_RGB( texture2D( phase_tex_g, posn ) );
  float dt_b = SUM_RGB( texture2D( phase_tex_b, posn ) );

  float dx = SUM_RGB(dx_);
  float dy = SUM_RGB(dy_);

  // gradient length
  float dd = sqrt(dx*dx + dy*dy + .001);

  // optical flow
  vec2 flow = scale * (1.0 + sin(dt + time)) / 2.0 * vec2(dx, dy) / dd; 

  vec2 flow_r = scale * (1.0 + sin(dt + time)) / 2.0 * vec2(dx_.r, dy_.r) / dd; 
  vec2 flow_g = scale * (1.0 + sin(dt_g + time)) / 2.0 * vec2(dx_.g, dy_.g) / dd; 
  vec2 flow_b = scale * (1.0 + sin(dt_b + time)) / 2.0 * vec2(dx_.b, dy_.b) / dd; 
 
 
  gl_FragColor = texture2D(tex , posn + flow);
  gl_FragColor = vec4(texture2D(tex , posn + flow_r).r, texture2D(tex , posn + flow_g).g, texture2D(tex , posn + flow_b).b, 1.0);
  //gl_FragColor = vec4(dd, dd, dd, dd);
}
  </script>


  <script src="static/js/twgl-full.min.js"></script>
  <script src="static/js/jquery.min.js"></script>
  <script src="static/js/script.js"></script>
</html>


